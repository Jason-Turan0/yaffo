{% extends "utilities/_base.html" %}
{% from "components/job_progress.html" import job_progress_card %}

{% block title %}Discover People - Utilities - Photo Organizer{% endblock %}

{% block utility_content %}
<div class="utility-page">
    <div class="page-header">
        <h1>Discover People</h1>
        <p class="subtitle">
            Automatically cluster similar faces and suggest new people or assignments
        </p>
    </div>

    {% if active_jobs|length > 0 %}
    <div class="section job-progress-section">
        <h2>Processing in Progress</h2>
        {% for job in active_jobs %}
        {{ job_progress_card(job) }}
        {% endfor %}
    </div>
    {% endif %}

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Unassigned Faces</div>
            <div class="stat-value">{{ unassigned_count }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Existing People</div>
            <div class="stat-value">{{ people_count }}</div>
        </div>
    </div>

    {% if unassigned_count > 0 %}
    <div class="section">
        <h2>Configuration</h2>
        <p class="section-description">
            Set the clustering sensitivity to group similar faces together.
            Lower values create tighter clusters (more strict), higher values create looser clusters.
        </p>

        <div class="config-form">
            <div class="form-group">
                <label for="distance-slider">
                    Clustering Distance: <span id="distance-value">5</span>
                </label>
                <input type="range" id="distance-slider" class="form-control-range"
                       min="1" max="10" step="1" value="5">
                <div class="slider-help-text">
                    Lower = stricter matching (more clusters, fewer false matches)<br>
                    Higher = looser matching (fewer clusters, more grouped faces)
                </div>
            </div>

            <button class="btn btn-primary" id="start-button">
                Discover People
            </button>
        </div>
    </div>
    {% else %}
    <div class="empty-state">
        <h2>No unassigned faces</h2>
        <p>All faces have been assigned or ignored.</p>
    </div>
    {% endif %}
</div>

<style>
.config-form {
    max-width: 500px;
    margin: 2rem 0;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #333;
}

.form-control-range {
    width: 100%;
    height: 6px;
    background: linear-gradient(to right, #4CAF50 0%, #f0f0f0 100%);
    border-radius: 3px;
    outline: none;
}

.slider-help-text {
    font-size: 0.875rem;
    color: #666;
    margin-top: 0.5rem;
    line-height: 1.5;
}

#distance-value {
    font-family: monospace;
    font-weight: 700;
    color: #4CAF50;
}
</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='utilities/discover_people.js') }}"></script>
<script>
window.PHOTO_ORGANIZER.initDiscoverPeople(
    {{ unassigned_count }},
    window.APP_CONFIG
);
</script>
{% endblock %}