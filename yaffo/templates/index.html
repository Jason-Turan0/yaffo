{% extends "base.html" %}

{% block title %}Home - Photo Organizer{% endblock %}

{% block extra_styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='filters/location-autocomplete.css') }}">
{% endblock %}

{% block content %}
{% from "_sidebar.html" import render_sidebar  %}
{% from "components/pagination.html" import pagination as render_pagination %}

<div class="main-container-layout">
    {% macro render_filters() %}
        {% include "filters/_people.html" %}
        {% include "filters/_tags.html" %}
        {% include "filters/_locations.html" %}
    {% endmacro %}
    {{ render_sidebar(url_for('index'), filters, render_filters) }}
    <div class="main-content photo-gallery">
        <div class="page-header">
            <h1>Photo Library</h1>
            <p class="subtitle">
                {% if photos|length > 0 %}
                    Showing {{ photos|length }} of {{photo_count}} photo{{ 's' if photos|length != 1 else '' }}
                {% else %}
                    No photos found
                {% endif %}
            </p>
        </div>

        {% if photos|length > 0 %}
        <div class="photo-grid">
            {% for photo in photos %}
            <div class="photo-card" onclick="window.open('{{ url_for('photo_view', photo_id=photo.id) }}', '_blank')">
                <img src="{{ url_for('photo', photo_id=photo.id) }}"
                     data-fallback="{{ url_for('placeholder') }}"
                     alt="Photo from {{ photo.date_taken | format_date ('date') }}">
                <div class="photo-info">
                    <div class="photo-date">{{ photo.date_taken | format_date ("date")  if photo.date_taken else 'Unknown date' }}</div>
                    {% if photo.people|length > 0 %}
                    <div class="photo-people">
                        {% for person in photo.people %}
                        <span class="person-tag">{{ person.name }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        {{ render_pagination(
            pagination.current_page,
            pagination.total_items,
            pagination.page_size,
            pagination.page_sizes,
            url_for('index'),
            {
                'year': filters.selected_year,
                'month': filters.selected_month,
                'person': filters.selected_person_ids,
                'person-match-type': filters.selected_person_match_type,
                'tag-name': filters.selected_tag_name,
                'tag-value': filters.selected_tag_value,
                'location': filters.selected_location_names,
                'location-match-type': filters.selected_location_match_type,
                'proximity-lat': filters.selected_proximity_lat,
                'proximity-lon': filters.selected_proximity_lon,
                'proximity-distance': filters.selected_proximity_distance,
                'proximity-location': filters.selected_proximity_location
            }
        ) }}
        {% else %}
        <div class="empty-state">
            <h2>No photos found</h2>
            <p>Try adjusting your filters or check back later.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='filters/location-autocomplete.js') }}"></script>
<script>
window.PHOTO_ORGANIZER.initLocationAutocomplete(window.APP_CONFIG);
</script>
{% endblock %}