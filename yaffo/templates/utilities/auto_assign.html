{% extends "utilities/_base.html" %}
{% from "components/job_progress.html" import job_progress_card %}
{% from "components/job_section.html" import job_section %}
{% from "components/percentage_slider.html" import percentage_slider %}

{% block title %}Auto-Assign People - Utilities - Photo Organizer{% endblock %}

{% block utility_content %}
<div class="utility-page">
    <div class="page-header">
        <h1>Auto-Assign People</h1>
        <p class="subtitle">
            Automatically find and assign unassigned faces to a person based on similarity
        </p>
    </div>

    {{ job_section(active_jobs, show_cancel=true, has_results=true) }}

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Total People</div>
            <div class="stat-value">{{ people|length }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Unassigned Faces</div>
            <div class="stat-value">{{ unassigned_count }}</div>
        </div>
    </div>

    {% if unassigned_count > 0 and people|length > 0 %}
    <div class="section">
        <h2>Configuration</h2>
        <p class="section-description">
            Select a person and set the similarity threshold to find matching faces.
        </p>

        <div class="config-form">
            <div class="form-group">
                <label for="person-select">Person</label>
                <select id="person-select" class="form-control">
                    <option value="">-- Select a person --</option>
                    {% for person in people %}
                    <option value="{{ person.id }}">{{ person.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                {{ percentage_slider("similarity", "Similarity Threshold:", 0.97 )  }}
                <div class="slider-help-text">
                    Higher values = more strict matching (fewer false positives)
                </div>
            </div>

            <button class="btn btn-primary" id="start-button" disabled>
                Find Matching Faces
            </button>
        </div>
    </div>
    {% elif unassigned_count == 0 %}
    <div class="empty-state">
        <h2>No unassigned faces</h2>
        <p>All faces have been assigned or ignored.</p>
    </div>
    {% elif people|length == 0 %}
    <div class="empty-state">
        <h2>No people defined</h2>
        <p>Create people first before using auto-assign.</p>
    </div>
    {% endif %}
</div>

<style>
.config-form {
    max-width: 500px;
    margin: 2rem 0;
}

.slider-help-text {
    font-size: 0.875rem;
    color: #666;
    margin-top: 0.5rem;
}

</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='utilities/auto_assign_people.js') }}"></script>
<script>
window.PHOTO_ORGANIZER.initAutoAssignPeople(
    {{ people | tojson }},
    {{ unassigned_count }},
    window.APP_CONFIG
);
</script>
{% endblock %}