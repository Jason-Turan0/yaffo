{% extends "utilities/_base.html" %}
{% from "components/file_browser.html" import file_browser %}
{% from "components/job_section.html" import job_section %}

{% block title %}Organize Photos - Utilities - Photo Organizer{% endblock %}

{% block utility_content %}
<div class="utility-page">
    <div class="page-header">
        <h1>Organize Photos</h1>
        <p class="subtitle">
            Automatically organize your photos into folders by date using EXIF metadata
        </p>
    </div>

     {{ job_section(active_jobs, show_cancel=true) }}

    <div class="section">
        <h2>Configuration</h2>
        <p class="section-description">
            Choose how you want to organize your photos into folders.
        </p>

        <div class="config-form">
            {{ file_browser(
                'source-directory',
                placeholder='Select source directory containing photos',
                show_label=True,
                label_text='Source Directory'
            )}}

           

            <div id="destination-directory-group" style="display: none;">
                {{ file_browser(
                    'destination-directory',
                    placeholder='Select destination directory',
                    show_label=True,
                    label_text='Destination Directory'
                ) }}
            </div>
             <div class="form-group">
                <label class="checkbox-label inline">
                    <input type="checkbox" id="change-directory-checkbox">
                    Change Directory?
                </label>
            </div>

            <div class="form-group">
                <label class="checkbox-label inline">
                    <input type="checkbox" id="keep-original-checkbox">
                    Keep original?
                </label>
            </div>

            <div class="form-group">
                <label for="organization-pattern">Organization Pattern</label>
                <select id="organization-pattern" class="form-control">
                    <option value="year_month">By Year and Month (2024/January/)</option>
                    <option value="year_month_day">By Year/Month/Day (2024/January/15/)</option>
                    <option value="year">By Year only (2024/)</option>
                </select>
            </div>

            <button class="btn btn-primary" id="preview-button">
                Preview Organization
            </button>
        </div>
    </div>

    <div id="preview-stats-section" style="display: none;">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Photos</div>
                <div class="stat-value" id="stat-total-files">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label" id="stat-operation-label">Files to Move</div>
                <div class="stat-value" id="stat-files-to-move">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Files Staying in Place</div>
                <div class="stat-value" id="stat-files-staying">0</div>
            </div>
        </div>
    </div>

    <div id="preview-section" class="section" style="display: none;">
        <h2>Preview</h2>
        <p class="section-description" id="preview-description">
            This is how your photos will be organized:
        </p>

        <div class="file-list">
            <div class="file-list-header">
                <div class="file-count" id="file-count-text"></div>
                <button class="btn btn-primary" id="start-button">
                    Start Organizing
                </button>
            </div>

            <div class="file-items" id="preview-content">
            </div>
        </div>
    </div>
</div>

<style>
.config-form {
    max-width: 500px;
    margin: 2rem 0;
}

.file-list {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    overflow: hidden;
}

.file-list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: white;
    border-bottom: 1px solid #dee2e6;
}

.file-count {
    font-weight: 500;
    color: #495057;
}

.file-items {
    max-height: 500px;
    overflow-y: auto;
}

.file-item {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #e9ecef;
    background: white;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.file-item:last-child {
    border-bottom: none;
}

.file-item.all-organized {
    text-align: center;
    color: #6c757d;
    padding: 2rem;
    display: block;
}

.file-source {
    font-family: 'Courier New', monospace;
    font-size: 0.875rem;
    color: #666;
    flex: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-right: auto;
}

.file-destination {
    font-family: 'Courier New', monospace;
    font-size: 0.875rem;
    color: #212529;
    flex: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-left: auto;
}

.arrow {
    font-size: 0.875rem;
    color: #007bff;
    margin-right: 0.5rem;
    align-self: center;
}
</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='utilities/organize_photos.js') }}"></script>
<script>
window.PHOTO_ORGANIZER.organizePhotos = window.PHOTO_ORGANIZER.initOrganizePhotos(window.APP_CONFIG);
</script>
{% endblock %}