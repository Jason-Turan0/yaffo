{% extends "utilities/_base.html" %}
{% from "components/job_progress.html" import job_progress_card %}
{% from "components/file_browser.html" import file_browser %}

{% block title %}Organize Photos - Utilities - Photo Organizer{% endblock %}

{% block utility_content %}
<div class="utility-page">
    <div class="page-header">
        <h1>Organize Photos</h1>
        <p class="subtitle">
            Automatically organize your photos into folders by date using EXIF metadata
        </p>
    </div>

    {% if active_jobs|length > 0 %}
    <div class="section job-progress-section">
        <h2>Processing in Progress</h2>
        {% for job in active_jobs %}
        {{ job_progress_card(job) }}
        {% endfor %}
    </div>
    {% endif %}

    <div class="section">
        <h2>Configuration</h2>
        <p class="section-description">
            Choose how you want to organize your photos into folders.
        </p>

        <div class="config-form">
            {{ file_browser(
                'source-directory',
                placeholder='Select source directory containing photos',
                show_label=True,
                label_text='Source Directory'
            )}}
            <div id="destination-directory-group" style="display: none;">
                {{ file_browser(
                    'destination-directory',
                    placeholder='Select destination directory',
                    show_label=True,
                    label_text='Destination Directory'
                ) }}
            </div>
            <div class="form-group">
                <label class="checkbox-label inline">
                    <input type="checkbox" id="move-files-checkbox">
                    Change Directory?
                </label>
            </div>



            <div class="form-group">
                <label for="organization-pattern">Organization Pattern</label>
                <select id="organization-pattern" class="form-control">
                    <option value="year_month">By Year and Month (2024/January/)</option>
                    <option value="year_month_day">By Year/Month/Day (2024/01/15/)</option>
                    <option value="year">By Year only (2024/)</option>
                </select>
                <div class="help-text">
                    Photos will be organized based on their EXIF date taken metadata
                </div>
            </div>

            <button class="btn btn-primary" id="preview-button">
                Preview Organization
            </button>
        </div>
    </div>

    <div id="preview-section" class="section" style="display: none;">
        <h2>Preview</h2>
        <p class="section-description">
            This is how your photos will be organized:
        </p>
        <div id="preview-content"></div>
        <button class="btn btn-primary" id="start-button">
            Start Organizing
        </button>
    </div>
</div>

<style>
.config-form {
    max-width: 500px;
    margin: 2rem 0;
}

.help-text {
    font-size: 0.875rem;
    color: #666;
    margin-top: 0.5rem;
}

#preview-content {
    background: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 1rem;
    margin: 1rem 0;
    max-height: 400px;
    overflow-y: auto;
    font-family: monospace;
}

.preview-folder {
    margin-left: 1rem;
    padding: 0.25rem 0;
}

.preview-count {
    color: #666;
    font-size: 0.875rem;
}
</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='utilities/organize_photos.js') }}"></script>
<script>
window.PHOTO_ORGANIZER.organizePhotos = window.PHOTO_ORGANIZER.initOrganizePhotos(window.APP_CONFIG);
</script>
{% endblock %}