{
  "files": [
    {
      "filename": "photo-gallery.spec.ts",
      "code": "import { test, expect } from '@playwright/test';\n\ntest.describe('Photo Gallery', () => {\n  test('gallery loads with valid images', async ({ page }) => {\n    // Navigate to the home page\n    await page.goto('/');\n    \n    // Wait for the gallery grid to be visible\n    await expect(page.locator('.photo-grid')).toBeVisible({ timeout: 10000 });\n    \n    // Collect all image elements in the gallery\n    const images = await page.locator('.photo-card img').all();\n    \n    // Verify at least one photo is displayed\n    expect(images.length).toBeGreaterThan(0);\n    \n    // Check each image source for HTTP 200 and ensure it's not using fallback\n    for (const image of images) {\n      const src = await image.getAttribute('src');\n      const fallbackSrc = await image.getAttribute('data-fallback');\n      \n      // Ensure we have a valid image source\n      expect(src).toBeTruthy();\n      \n      // Verify the image is not using the fallback placeholder\n      expect(src).not.toEqual(fallbackSrc);\n      \n      // Make HTTP request to verify image returns 200\n      if (src) {\n        const baseUrl = new URL(page.url()).origin;\n        const imageUrl = src.startsWith('/') ? `${baseUrl}${src}` : src;\n        \n        const response = await page.request.get(imageUrl);\n        expect(response.status()).toBe(200);\n        \n        // Verify it's actually an image by checking content-type\n        const contentType = response.headers()['content-type'];\n        expect(contentType).toMatch(/^image\\//i);\n      }\n    }\n    \n    // Verify gallery grid container is visible\n    await expect(page.locator('.photo-gallery')).toBeVisible();\n    \n    // Verify no empty state is shown\n    await expect(page.locator('.empty-state')).not.toBeVisible();\n  });\n  \n  test('gallery filter year works', async ({ page }) => {\n    // Navigate to the home page\n    await page.goto('/');\n    \n    // Wait for the gallery grid to be visible\n    await expect(page.locator('.photo-grid')).toBeVisible({ timeout: 10000 });\n    \n    // Verify at least one year is in the filter dropdown\n    const yearSelect = page.locator('#year-select');\n    await expect(yearSelect).toBeVisible();\n    \n    // Get all year options (excluding \"All Years\")\n    const yearOptions = await yearSelect.locator('option:not([value=\"\"])').all();\n    expect(yearOptions.length).toBeGreaterThan(0);\n    \n    // Get the first available year\n    const firstYearOption = yearOptions[0];\n    const selectedYear = await firstYearOption.getAttribute('value');\n    expect(selectedYear).toBeTruthy();\n    \n    // Count initial photos before filtering\n    const initialPhotos = await page.locator('.photo-card').all();\n    const initialCount = initialPhotos.length;\n    expect(initialCount).toBeGreaterThan(0);\n    \n    // Select a year from the Year filter\n    await yearSelect.selectOption(selectedYear!);\n    \n    // Click Apply Filters\n    await page.locator('button.filter-btn').click();\n    \n    // Wait for page to reload/update\n    await page.waitForLoadState('networkidle');\n    \n    // Verify gallery grid is still visible after filtering\n    await expect(page.locator('.photo-grid')).toBeVisible();\n    \n    // Verify URL contains the year parameter\n    const currentUrl = page.url();\n    expect(currentUrl).toContain(`year=${selectedYear}`);\n    \n    // Get all photo cards after filtering\n    const filteredPhotos = await page.locator('.photo-card').all();\n    \n    // Verify we still have photos (at least one should match the year)\n    expect(filteredPhotos.length).toBeGreaterThan(0);\n    \n    // Verify all displayed photos are from the selected year\n    for (const photoCard of filteredPhotos) {\n      const photoDate = await photoCard.locator('.photo-date').textContent();\n      expect(photoDate).toBeTruthy();\n      \n      // Extract year from date string (assuming format like \"January 1, 2023\")\n      if (photoDate && !photoDate.includes('Unknown date')) {\n        expect(photoDate).toContain(selectedYear!);\n      }\n    }\n    \n    // Click Clear Filters\n    await page.locator('button.clear-filters').click();\n    \n    // Wait for page to reload\n    await page.waitForLoadState('networkidle');\n    \n    // Verify URL no longer contains year parameter\n    const clearedUrl = page.url();\n    expect(clearedUrl).not.toContain('year=');\n    \n    // Verify gallery grid is still visible\n    await expect(page.locator('.photo-grid')).toBeVisible();\n    \n    // Verify year select is back to \"All Years\"\n    const selectedValue = await yearSelect.inputValue();\n    expect(selectedValue).toBe('');\n    \n    // Verify all photos are shown again (should be >= initial count)\n    const finalPhotos = await page.locator('.photo-card').all();\n    expect(finalPhotos.length).toBeGreaterThanOrEqual(initialCount);\n  });\n});",
      "description": "Tests for photo gallery functionality including image loading validation and year filter functionality"
    }
  ],
  "testContext": "This test suite validates the core photo gallery functionality. It tests that images load correctly without broken links and verifies the year filtering system works properly. The tests use actual selectors from the template (.photo-grid, .photo-card, #year-select, etc.) and validate both client-side behavior and server responses.",
  "explanation": "The tests are built using the actual HTML structure from templates/index.html and the year filter from templates/filters/_year.html. The first test validates that all images return HTTP 200 responses and aren't using fallback placeholders. The second test validates the complete year filtering workflow including URL parameter changes and proper clearing of filters. Both tests include proper waiting strategies for dynamic content loading.",
  "confidence": 0.95
}